---
layout: post
title: "Installing OpenShift in Manual Credentials Mode"
author: naikoob
tags: [aws, cloud, kubernetes, openshift]
---
:source-highlighter: rouge
:imagesdir: /blog/assets/img/2021-04-20-manual-credentials-mode
:page-liquid:
:icons: font

A step-by-step walk-through of installing OpenShift (on AWS) with Installer-provisioned Infrastructure using manual credentials mode.

== why

OpenShift comes with a Cloud Credentials Operator that manages the credentials used to operate the cluster. However, many organizations have established processes and controls to manage IAM credentials, and prefer (or mandated) to utilize their existing processes and mechanisms for consistency/compliance and various reasons. 

== getting the installer

Download the OpenShift installer https://cloud.redhat.com/openshift/install/aws/installer-provisioned[here, window='_blank']. You may need to create a Red Hat account if you don't already have one. This is also where you download your pull secret that you'll need later in the installation process.

== installation credential

We need to run the installer using an AWS account with the necessary permissions to provision VPC and other resources. This can be an administrator account or and account provisioned with the necessary permissions as documented https://docs.openshift.com/container-platform/4.7/installing/installing_aws/installing-aws-account.html#installation-aws-permissions_installing-aws-account[here, window='_blank'].

I have an example policy defined on https://gist.github.com/naikoob/d9d3d0a866d02ea485a4a988e7428acd#file-openshift-install-less-iam-policy-json[github gist, window='_blank']. We create an IAM user with this policy attached using the AWS CLI, or web console. 

== enter terraform

However, in this article, I'm using Terraform, which you can download from https://www.terraform.io/[here, window='_blank'].

Clone my terraform config like so:
[source]
----
git clone https://github.com/naikoob/openshift-aws-terraform.git
----

Initialize the terraform working directory:
[source]
----
terraform init
----

We can review what gets created by the config with 
[source]
----
terraform plan
----

Finally, apply the changes with 
[source]
----
terraform apply
----

When terraform completes, the following set of users will be created:

image::users.png[]

the following policies are also created

image::policies.png[]

Finally, the following files are generated:

image::generated-files.png[]

== invoking the installer

One of the generated files above is the "installer-credentials". This is the credential file for the `openshift-installer` user created by the Terraform config above. Append this to your AWS CLI credentials file (typically `~/.aws/credentials`). 

